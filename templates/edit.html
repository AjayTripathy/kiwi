$def with (contentList, statistics)

<html>
	<head>
		<title>You are now writing better!</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js" type="text/javascript"></script>
		<script src="/static/jquery.editable-1.3.3.min.js"></script>
		<script src="/static/jit-yc.js"></script>
		<link rel="stylesheet" type="text/css" href="static/master.css"/>
		<script src="/static/jquery.qtip-1.0.0-rc3.min.js"></script>

		<script type="text/javascript">
		jQuery(document).ready(function() {
			var jsonarray = $:(contentList)
			for (i in jsonarray) {
				var jsonobj = jsonarray[i]
				var jsonword = jsonobj.word
				var isSpecialChar = jsonobj.specialChar
				if (isSpecialChar == true) {
					if (jsonobj.word == "space") {
						jQuery('#yourwriting').append(" ")
					} else if (jsonobj.word == "paragraphbreak") {
						jQuery('#yourwriting').append("<br><br>")
					}
				} else {
					var isRepetition = jsonobj.properties.repetitions
					var stem = jsonobj.properties.stem
					var toInsert = ""
					if (isRepetition) {
						toInsert = "<span class = 'repetition' title='"+stem+"'>"+jsonword+"</span>"
					} else {
						toInsert = "<span title='"+stem+"'>"+jsonword+"</span>"
					}
					jQuery('#yourwriting').append(toInsert)
				}
			}

			var cleanAfterInsert = function () {
				jQuery(".repetition").css("font-weight", "bold")
				jQuery(".repetition").css("color", "#366C36")

				jQuery(".repetition").mouseover(function () {
					jQuery("span[title='"+this.title+"']").css("color", "red")
				})

				jQuery(".repetition").mouseleave(function () {
					jQuery("span[title='"+this.title+"']").css("color", "#366C36")
				})

				jQuery("span").editable({onSubmit: clean})

				var process = function (result) {
					console.log('yay')
				}

				jQuery("span").qtip({
					content: "Loading...",
					api: {
						beforeShow: function () {
							var self = this

							
							jQuery.ajax({
								url: "http://thesaurus.altervista.org/thesaurus/v1?callback=?",
								dataType: "jsonp",
								data: {
									key: "5ru41HyCW2H8XUbNoIUm",
									word: self.elements.target.text(),
									language: "en_US",
									output: "json"
								},
								timeout: 1000,
								success: function (data) {
								self.updateContent(data.response[0].list.synonyms)
								}	

							}).error(function() {
								self.updateContent("No synonyms :(")
							});
						}
					},
					show: 'mouseover',
					hide: 'mouseout',
					
					position: {
						corner: {
							target: 'topRight',
							tooltip: 'bottomLeft'
						}
					},
					style: {
						name: 'cream',
						tip: {
							corner:'bottomLeft',
							size: {
								x: 3,
								y: 3
							}
						}
					}
				});

			}

			cleanAfterInsert()

			

			var clean = function () {
				var text = jQuery("#yourwriting").text()
				jQuery('#yourwriting').html("")
				end(text)
			}
			
			var end = function (toSend) {
				var self = this
				jQuery.post("/rev", {text : toSend}, function (info) {
					jsonArray = info.text

					for (i in jsonArray) {
						var jsonobj = jsonArray[i]
						var jsonword = jsonobj.word
						var isSpecialChar = jsonobj.specialChar
						if (isSpecialChar == true) {
							if (jsonobj.word == "space") {
								jQuery('#yourwriting').append(" ")
							} else if (jsonobj.word == "paragraphbreak") {
								jQuery('#yourwriting').append("<br><br>")
							}
						} else {
							var isRepetition = jsonobj.properties.repetitions
							var stem = jsonobj.properties.stem
							var toInsert = ""
							if (isRepetition) {
								toInsert = "<span class = 'repetition' title='"+stem+"'>"+jsonword+"</span>"
							} else {
								toInsert = "<span title='"+stem+"'>"+jsonword+"</span>"
							}
							jQuery('#yourwriting').append(toInsert)
						}
					}

					cleanAfterInsert()
				}, "json");
			}

			


			var statisticsJSON = $:(statistics)
			console.log(statisticsJSON)
			var wordCount = statisticsJSON.wordCount
			var barChart = new $$jit.BarChart({
				injectInto: 'wordcount',
				animate: true, 
				orientation: 'vertical', 
				barsOffset: 20,
				Margin: {
					top: 5,
					left: 5,
					right: 5,
					bottom: 5
				},
				labelOffset: 5, 
				type: 'stacked',
				showAggregates: true,
				showLabels: true, 
			});
			barChart.loadJSON(statisticsJSON)
			
			
	
		});

		</script>

	</head>

	<body>
		<div id="main">
			<div id="logo"><img src="static/logo.png"></div>
			<div class="clear"></div>
			<br>We've bolded the possible repetitions below. Double click and change stuff on the fly!
			<br>
			<br>
			<div id="yourwriting"></div>
			<br>
			<br>
			<div id="wordcount"></div>
			<div class="clear"></div>
			
		</div>

		
	</body>
</html>